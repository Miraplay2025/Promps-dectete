<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prompt Detector</title>

<style>
body { background:#0f172a;color:#fff;font-family:system-ui;padding:16px }
.container { max-width:900px;margin:auto }
textarea { width:100%;min-height:200px;border-radius:10px;padding:12px;border:none }
button { margin-top:12px;width:100%;padding:12px;border-radius:10px;border:none;background:#22c55e;font-size:16px }
.progress { margin-top:16px;background:#334155;border-radius:10px }
.bar { height:12px;width:0%;background:#22c55e }
.log { margin-top:12px;background:#1e293b;padding:8px;height:140px;overflow:auto;font-size:12px }
.output { margin-top:12px;background:#020617;height:40vh;padding:12px;border-radius:10px;overflow:auto }
</style>
</head>

<body>
<div class="container">
<h2>Detector de Prompts</h2>

<textarea id="input"></textarea>
<button onclick="start()">Processar</button>

<div class="progress"><div id="bar" class="bar"></div></div>
<div id="log" class="log"></div>
<div id="output" class="output"></div>
</div>

<script>
let ws;
const logEl = document.getElementById("log");
const bar = document.getElementById("bar");
const out = document.getElementById("output");

function log(msg) {
  logEl.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
  logEl.scrollTop = logEl.scrollHeight;
}

function start() {
  logEl.textContent = "";
  out.textContent = "";
  bar.style.width = "0%";

  ws = new WebSocket(`ws://${location.host}`);
  log("Conectando ao servidor...");

  ws.onopen = () => {
    log("Conectado. Enviando texto.");
    ws.send(document.getElementById("input").value);
  };

  ws.onmessage = e => {
    const d = JSON.parse(e.data);

    if (d.progress !== undefined) {
      bar.style.width = d.progress + "%";
      log("Processando linha...");
    }

    if (d.done) {
      out.textContent = d.prompts.join("\n\n");
      log("Finalizado.");
      ws.close();
    }
  };
}
</script>
</body>
</html>
